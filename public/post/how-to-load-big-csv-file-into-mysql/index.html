<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon-32x32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple-touch-icon.png><meta itemprop=name content="详解：如何将一个大的结构化（CSV）数据导入到 MySQL"><meta itemprop=description content="记录我的生活、工作与成长。"><meta name=description content="记录我的生活、工作与成长。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://a2htray.github.io/imgs/my_avatar.jpg"><meta itemprop=keywords content="工作,解决问题,Shell"><meta property="og:type" content="article"><meta property="og:title" content="详解：如何将一个大的结构化（CSV）数据导入到 MySQL"><meta property="og:description" content="记录我的生活、工作与成长。"><meta property="og:image" content="/imgs/my_avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://a2htray.github.io/post/how-to-load-big-csv-file-into-mysql/"><meta property="og:site_name" content="快乐冲浪与生活"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="a2htray"><meta property="article:published_time" content="2025-12-10 09:19:39 +0800 CST"><meta property="article:modified_time" content="2025-12-10 09:19:39 +0800 CST"><link type=text/css rel=stylesheet href=https://a2htray.github.io/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://a2htray.github.io/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://a2htray.github.io/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1772112706"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><link rel=stylesheet type=text/css href="/css/custom_style.css?=1772112706"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>详解：如何将一个大的结构化（CSV）数据导入到 MySQL - 快乐冲浪与生活</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>快乐冲浪与生活</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>多体验、多体会、多体悟</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tag hvr-icon"></i>标签</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#实际需求>实际需求</a></li><li><a href=#mysql-环境>MySQL 环境</a></li><li><a href=#创建-mysql-表>创建 MySQL 表</a></li><li><a href=#编写-shell-脚本>编写 Shell 脚本</a><ul><li><a href=#拆分大文件>拆分大文件</a></li><li><a href=#按小文件导入并记录日志>按小文件导入并记录日志</a></li></ul></li><li><a href=#小坑>小坑</a></li><li><a href=#小结>小结</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=a2htray src=/imgs/img-lazy-loading.gif data-src=/imgs/my_avatar.jpg><p class=site-author-name itemprop=name>a2htray</p><div class=site-description itemprop=description>记录我的生活、工作与成长。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>136</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>30</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>102</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/a2htray title="Github → https://github.com/a2htray" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://a2htray.github.io/post/how-to-load-big-csv-file-into-mysql/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/my_avatar.jpg"><meta itemprop=name content="a2htray"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="a2htray"><meta itemprop=description content="记录我的生活、工作与成长。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="详解：如何将一个大的结构化（CSV）数据导入到 MySQL"><meta itemprop=description content="实际需求

昨天领了一个任务，把一个大文件数据导入到 MySQL，文件以 CSV 格式给出，内容是收集的 600 多万条的文献信息。
接到时，我觉得很简单，实现思路是：

（前置）部署一个 MySQL 的服务
根据 CSV 的表头信息，创建一个表
将大文件拆成多个小文件，小文件包含表头信息
遍历所有小文件，应用 LOAD DATA INFILE 语句进行导入

为了让整个过程更好追踪，还加入小文件导入日志和汇总主日志的功能。因为是一个即时的任务，并不需要考虑太多后期的扩展，所以采用 Shell 脚本
的方式实现。"></span><header class=post-header><h1 class=post-title itemprop="name headline">详解：如何将一个大的结构化（CSV）数据导入到 MySQL
<a href=https://github.com/a2htray/a2htray.github.io/tree/main/content/post/how-to-load-big-csv-file-into-mysql.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2025-12-10 09:19:39 +08:00" itemprop="dateCreated datePublished" datetime="2025-12-10 09:19:39 +0800 CST">2025-12-10
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/mysql/ itemprop=url rel=index><span itemprop=name>后端技术/MySQL</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>1598</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>4分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/how-to-load-big-csv-file-into-mysql/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=实际需求>实际需求
<a class=header-anchor href=#%e5%ae%9e%e9%99%85%e9%9c%80%e6%b1%82></a></h2><p>昨天领了一个任务，把一个大文件数据导入到 MySQL，文件以 CSV 格式给出，内容是收集的 600 多万条的文献信息。</p><p>接到时，我觉得很简单，实现思路是：</p><ol><li>（前置）部署一个 MySQL 的服务</li><li>根据 CSV 的表头信息，创建一个表</li><li>将大文件拆成多个小文件，小文件包含表头信息</li><li>遍历所有小文件，应用 <code>LOAD DATA INFILE</code> 语句进行导入</li></ol><p>为了让整个过程更好追踪，还加入<code>小文件导入日志</code>和<code>汇总主日志</code>的功能。因为是一个即时的任务，并不需要考虑太多后期的扩展，所以采用 <code>Shell</code> 脚本
的方式实现。</p><a id=more></a><p>但在实现的过程中，还是遇到了一些不少的问题，大概也花了 3 个小时左右。</p><h2 id=mysql-环境>MySQL 环境
<a class=header-anchor href=#mysql-%e7%8e%af%e5%a2%83></a></h2><p>MySQL，我用 Docker 启的，因为考虑到后面要做数据查询服务，所以按 <code>docker-compose</code> 的方式进行编排，内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>demo_db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:8.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>demo_db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>13306</span><span class=p>:</span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>demo_mysql_data:/var/lib/mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>../data:/var/lib/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>../scripts:/var/lib/scripts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>demo_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>MYSQL_ROOT_PASSWORD=demo_20251209</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>MYSQL_DATABASE=demo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>TZ=Asia/Shanghai</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>demo_mysql_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>demo_network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>docker-compose 目前还不包含应用的部分。</p></blockquote><h2 id=创建-mysql-表>创建 MySQL 表
<a class=header-anchor href=#%e5%88%9b%e5%bb%ba-mysql-%e8%a1%a8></a></h2><p>CSV 文件的表头很多，将近 90 个，所以不太可能逐一映射到数据库的字段。在这种情况下，大语言模型就派上用场了。</p><p>我比较常用的工具是豆包。</p><p>首先，我把文件前两行的内容给到豆包，它帮我说明了表头信息及对应的内容解释。</p><p>然后，又给豆包提了个要求，生成 Create 语句，内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>请根据我给的信息，帮我生成一个名称叫 demo_table 的 mysql 表的 CREATE 语句，
</span></span><span class=line><span class=cl>要求字段要小写，且顺序不能变。</span></span></code></pre></td></tr></table></div></div><p>果然，豆包给了一个详尽可用的 <code>CREATE</code> 语句</p><p>最后，复制语句为 <code>./scripts/create_demo_table.sql</code> 文件，并在容器中执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mysql -rroot -pdemo_20251209 demo &lt; ./scripts/create_demo_table.sql</span></span></code></pre></td></tr></table></div></div><p><strong>到这里，就会为后面埋下一个坑。</strong></p><p>至此，MySQL 环境已经具备了。</p><h2 id=编写-shell-脚本>编写 Shell 脚本
<a class=header-anchor href=#%e7%bc%96%e5%86%99-shell-%e8%84%9a%e6%9c%ac></a></h2><p>Shell 脚本要主要实现两个功能：</p><ol><li>拆分大文件</li><li>按小文件导入并记录日志</li></ol><h3 id=拆分大文件>拆分大文件
<a class=header-anchor href=#%e6%8b%86%e5%88%86%e5%a4%a7%e6%96%87%e4%bb%b6></a></h3><p><strong>拆分大文件</strong>后小文件都要带相同的表头。</p><p>首先，使用 <code>head</code> 命令将表头输入到临时文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>head -1 ./BIG_FILE.csv &gt; ./header.tmp</span></span></code></pre></td></tr></table></div></div><ul><li><code>head -1</code> 表示只取头一行。</li></ul><p>然后，从第 2 行（包括第 2 行）开始将大文件拆成小文件，我按 5000 条记录一个文件的方式拆，命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir ./split_dir
</span></span><span class=line><span class=cl>tail -n +2 ./BIG_FILE.csv &gt; split -l <span class=m>5000</span> - ./split_dir/samll_file</span></span></code></pre></td></tr></table></div></div><ul><li><code>tail -n +2 ./BIG_FILE.csv</code> 从第 2 行（包括第 2 行）将文件内容输出终端</li><li><code>-l 5000</code> 以每个文件 5000 条记录来拆</li><li><code>split</code> 中的 <code>-</code> 表示从标准输出中读取数据</li><li><code>./split_dir/samll_file</code> 小文件放置的目录及其前缀</li></ul><p>最后，给每个小文件加入表头，这里需要用到 <code>for</code> 循环：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>for</span> samll_file in ./split_dir/small_file*<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  cat ./header.tmp <span class=si>${</span><span class=nv>small_file</span><span class=si>}</span> &gt; <span class=si>${</span><span class=nv>small_file</span><span class=si>}</span>.tmp
</span></span><span class=line><span class=cl>  mv <span class=si>${</span><span class=nv>small_file</span><span class=si>}</span>.tmp <span class=si>${</span><span class=nv>small_file</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=k>done</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>for</code> 循环，遍历目录下的小文件</li><li><code>cat</code> 接两个文件，将两个文件的内容输出到临时文件</li><li><code>mv</code> 将临时文件命名为原名</li></ul><p>至此，大文件拆成小文件已经完成。</p><h3 id=按小文件导入并记录日志>按小文件导入并记录日志
<a class=header-anchor href=#%e6%8c%89%e5%b0%8f%e6%96%87%e4%bb%b6%e5%af%bc%e5%85%a5%e5%b9%b6%e8%ae%b0%e5%bd%95%e6%97%a5%e5%bf%97></a></h3><p>这里，我需要一个主日志文件来记录每个小文件的导入情况：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>main_log_file</span><span class=o>=</span>./main.log</span></span></code></pre></td></tr></table></div></div><p>可以先记录一个拆分的统计信息，如拆分成小文件的数量：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>small_files</span><span class=o>=(</span>./split_dir/small_file*<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>small_file_num</span><span class=o>=</span><span class=si>${#</span><span class=nv>small_files</span><span class=p>[@]</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;大文件拆小文件完成，共拆分成 </span><span class=si>${</span><span class=nv>small_file_num</span><span class=si>}</span><span class=s2> 个小文件&#34;</span> &gt;&gt; <span class=si>${</span><span class=nv>main_log_file</span><span class=si>}</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>${#数组名[@]}</code> 是 Shell 中获取数组元素个数的标准语法</li></ul><p>再建一个 <code>for</code> 循环进行数据的导入，同时写入各自小文件的日志文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>for</span> samll_file in <span class=si>${</span><span class=nv>samll_files</span><span class=si>}</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;开始导入 </span><span class=si>${</span><span class=nv>samll_file</span><span class=si>}</span><span class=s2>&#34;</span> &gt;&gt; <span class=si>${</span><span class=nv>main_log_file</span><span class=si>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nv>file_name</span><span class=o>=(</span>basename <span class=si>${</span><span class=nv>small_file</span><span class=si>}</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>small_file_log</span><span class=o>=</span><span class=s2>&#34;./{</span><span class=nv>$file_name</span><span class=s2>}.log&#34;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  mv <span class=si>${</span><span class=nv>small_file</span><span class=si>}</span> /var/lib/mysql-files/<span class=si>${</span><span class=nv>file_name</span><span class=si>}</span> 2&gt;<span class=p>&amp;</span>! &gt;&gt; <span class=si>${</span><span class=nv>small_file_log</span><span class=si>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;执行 LOAD DATA INFILE 导入&#34;</span> &gt;&gt; <span class=si>${</span><span class=nv>small_file_log</span><span class=si>}</span>
</span></span><span class=line><span class=cl>  <span class=nv>sql</span><span class=o>=</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>LOAD DATA INFILE &#39;/var/lib/mysql-files/</span><span class=si>${</span><span class=nv>file_name</span><span class=si>}</span><span class=s2>&#39;
</span></span></span><span class=line><span class=cl><span class=s2>INTO TABLE demo_table
</span></span></span><span class=line><span class=cl><span class=s2>CHARACTER SET utf8mb4
</span></span></span><span class=line><span class=cl><span class=s2>FIELDS TERMINATED BY &#39;,&#39;
</span></span></span><span class=line><span class=cl><span class=s2>OPTIONALLY ENCLOSED BY &#39;\&#34;&#39;
</span></span></span><span class=line><span class=cl><span class=s2>LINES TERMINATED BY &#39;\n&#39;
</span></span></span><span class=line><span class=cl><span class=s2>IGNORE 1 ROWS&#34;</span>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=si>${</span><span class=nv>table_fields</span><span class=si>}</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  if mysql -rroot -pdemo_20251209 demo -e &#34;</span><span class=si>${</span><span class=nv>sql</span><span class=si>}</span><span class=s2>&#34; &gt;&gt; </span><span class=si>${</span><span class=nv>samll_file_log</span><span class=si>}</span><span class=s2> 2&gt;&amp;1; then
</span></span></span><span class=line><span class=cl><span class=s2>    echo &#34;</span>SUCCESS: <span class=si>${</span><span class=nv>samll_file_log</span><span class=si>}</span> 导入成功！<span class=s2>&#34; &gt;&gt; </span><span class=si>${</span><span class=nv>main_log_file</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  else
</span></span></span><span class=line><span class=cl><span class=s2>    echo &#34;</span>ERROR: 导入失败！详情见 <span class=si>${</span><span class=nv>samll_file_log</span><span class=si>}</span><span class=s2>&#34; &gt;&gt; </span><span class=si>${</span><span class=nv>main_log_file</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  fi
</span></span></span><span class=line><span class=cl><span class=s2>done  </span></span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：<code>${table_fields}</code> 里面是按 CSV 中表头顺序映射到数据库的字段名，使用逗号分隔。</p></blockquote><p>脚本的逻辑还是非常清晰的：</p><ol><li>遍历每一个小文件，声明小文件的日志文件</li><li>将小文件移到到 <code>/var/lib/mysql-files</code> 目录下</li><li>执行 <code>LOAD DATA INFIILE</code> 语句</li><li>将命令的终端输出写入到小文件日志文件</li><li>根据命令的执行成功与否，将信息写入到主日志文件</li></ol><p>主要功能到目前，都已经完成了，后面都是一些锦上添花的事。</p><h2 id=小坑>小坑
<a class=header-anchor href=#%e5%b0%8f%e5%9d%91></a></h2><p>还记得上面说的“留了一个坑”。究其原因，在于豆包根据给定信息生成的 CREATE 语句中，字段类型无法涵盖真实字段值。</p><p>比如，CREATE 语句中的字段类型是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>但是，真实值超过 64 个字符。再比较，有一些日期字段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=nb>DATE</span></span></span></code></pre></td></tr></table></div></div><p>而真实值可能如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2020
</span></span><span class=line><span class=cl>2020.12</span></span></code></pre></td></tr></table></div></div><p>类似这种情况，只能导一次，看到哪个字段类型声明不恰当，修改一遍再执行。</p><h2 id=小结>小结
<a class=header-anchor href=#%e5%b0%8f%e7%bb%93></a></h2><p>任务其实是很简单的，整体思路也非常清晰，优化的空间也很有，比如将小文件的导入由串行改成并行。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/%E5%B7%A5%E4%BD%9C/>工作
</a><a href=/tags/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/>解决问题
</a><a href=/tags/shell/>Shell</a></div><div class=post-share-tools><div class=post-share-loading><i class="fa-solid fa-ellipsis fa-spin"></i></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class=a2a_dd href=https://www.addtoany.com/share></a><a class=a2a_button_wechat></a><a class=a2a_button_qzone></a><a class=a2a_button_sina_weibo></a><a class=a2a_button_douban></a><a class=a2a_button_facebook></a><a class=a2a_button_x></a><a class=a2a_button_email></a><a class=a2a_button_printfriendly></a></div></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/pay_zhifubao.png alt="a2htray - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/pay_wechat.png alt="a2htray - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
详解：如何将一个大的结构化（CSV）数据导入到 MySQL</li><li class=post-copyright-author><strong>本文作者： </strong>a2htray</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://a2htray.github.io/post/how-to-load-big-csv-file-into-mysql/ title="详解：如何将一个大的结构化（CSV）数据导入到 MySQL">https://a2htray.github.io/post/how-to-load-big-csv-file-into-mysql/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/white.svg title="Not By AI"></a></div></li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/life/small-thought/ rel=next title=自制力的重要性><i class="fa fa-chevron-left"></i> 自制力的重要性</a></div><div class="post-nav-prev post-nav-item"><a href=/post/life/some-thoughts-on-job-hunting/ rel=prev title=一些关于找工作的想法>一些关于找工作的想法
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2025 - 2026
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>a2htray</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script class=next-config data-name=page type=application/json>{"clipboard":{"js":{"alias":"clipboard","file":"dist/clipboard.min.js","name":"clipboard.js","version":"2.0.11"}},"comments":false,"expired":false,"isHome":false,"isPage":true,"math":{"css":{"alias_name":"KaTeX","file":"dist/katex.min.css","name":"katex","version":"0.16.15"},"js":[{"alias_name":"KaTeX","file":"dist/katex.min.js","name":"katex","version":"0.16.15"},{"alias":"katex","alias_name":"KaTeX","file":"dist/contrib/auto-render.min.js","name":"auto-render","version":"0.16.15"}],"render":"katex"},"path":"how-to-load-big-csv-file-into-mysql","permalink":"https://a2htray.github.io/post/how-to-load-big-csv-file-into-mysql/","title":"详解：如何将一个大的结构化（CSV）数据导入到 MySQL","toc":true,"waline":{"commentcnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}}}</script><script type=text/javascript src=https://a2htray.github.io/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://a2htray.github.io/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"hostname":"https://a2htray.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":true},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://a2htray.github.io/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.min.js?=1772112706" defer></script><script type=text/javascript src="/js/clipboard.min.js?=1772112706" defer></script><script type=text/javascript src="/js/math.min.js?=1772112706" defer></script></body></html>